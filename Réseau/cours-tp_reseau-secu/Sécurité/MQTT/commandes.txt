openssl x509 -req -in broker.csr -CA ../ca/ca.crt -CAkey ../ca/ca.key -CAcreateserial -out broker.crt -days 100


openssl x509 -req -in client.csr -CA ../ca/ca.crt -CAkey ../ca/ca.key -CAcreateserial -out client.crt -days 100



CN : brocker = hostname de la machinemosquitto_pub -p 8883 --cafile ./ca_certificates/ca.crt --cert ./certs/brocker.crt --key ./mytls/brocker.key -h debian2 -m hello -t "world"

mosquitto_pub -p 8883 --cafile /home/olivier/TP/certs/ca/ca.crt --cert /home/olivier/TP/certs/client/client.crt --key /home/olivier/TP/certs/client/client.key -h 192.168.56.101 -m hello -t "world"


mosquitto_pub -p 8883 --cafile /home/olivier/TP/certs/ca/ca.crt --cert /home/olivier/TP/certs/client/client.crt --key /home/olivier/TP/certs/client/client.key -h debian2 -m hello -t "world"

CLient 2
mosquitto_pub -p 8883 --cafile /home/olivier/TP/certs/ca/ca.crt --cert /home/olivier/TP/certs/client2/client.crt --key /home/olivier/TP/certs/client2/client.key -h debian2 -m hello -t "world"



Le lot de données produit par tshark n’est pas forcément le plus lisible. Filtrons :
tshark -Y mqtt -T fields -e mqtt.topic

Brocker to Brocker



openssl x509 -in broker.crt -text -noout

Générer certificat CLient :
	openssl genrsa -out client.key 2048 && openssl req -out client.csr -key client.key -new &&	openssl x509 -req -in client.csr -CA ../ca/ca.crt -CAkey ../ca/ca.key -CAcreateserial -out client.crt -days 100
	
	
	
Test From github :
openssl genrsa -out client.key 2048 && openssl req -out client.csr -key client.key -new && openssl x509 -req -in client.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out client.crt -days 1095
openssl genrsa -out brocker.key 2048 && openssl req -out brocker.csr -key brocker.key -new && openssl x509 -req -in brocker.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out brocker.crt -days 1095

sudo scp brocker.key olivier@192.168.56.101:/etc/mosquitto/test2/

mosquitto_pub -p 8883 --cafile /home/olivier/TP/certs2/ca.crt --cert /home/olivier/TP/certs2/client.crt --key /home/olivier/TP/certs2/client.key -h debian2 -m hello -t "world"

mosquitto_pub -p 8883 --cafile /home/olivier/TP/certs/ca/ca.crt --cert home/olivier/TP/certs/client/client.crt --key client.key -h 192.168.56.101 -m hello -t "cheese/strudel"


TEST 3 github :
openssl genrsa -out client.key 2048 && openssl req -new -out client.csr  -key client.key -subj "/CN=client/O=example.com"  && openssl x509 -req -in client.csr -CA ca.crt -CAkey ca.key -CAserial ./ca.srl -out client.crt -days 3650 -addtrust clientAuth
openssl genrsa -out brocker.key 2048 && openssl req -new -out brocker.csr  -key brocker.key -subj "/CN=client/O=example.com"  && openssl x509 -req -in brocker.csr -CA ca.crt -CAkey ca.key -CAserial ./ca.srl -out brocker.crt -days 3650 -addtrust clientAuth